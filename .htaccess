Options -Indexes
DirectoryIndex index.php

# =========================
# Security headers snippet
# =========================
<IfModule mod_headers.c>
  Header always unset X-Powered-By
  Header unset X-Powered-By
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
</IfModule>

# Avoid missing custom error documents (prevents noisy logs on some hosts)
# Comment out if you intentionally use 404.shtml/500.shtml
ErrorDocument 404 default
ErrorDocument 500 default
ErrorDocument 403 default

# Ensure common public files are accessible
<Files "sw.js">
  Require all granted
</Files>
<Files "robots.txt">
  Require all granted
</Files>

# =========================
# Rewrite routing
# =========================
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # -------------------------
  # Do not rewrite real files
  # -------------------------
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule ^ - [L]

  # -----------------------------------------------------
  # Do not rewrite real directories (except our pseudo ones)
  # -----------------------------------------------------
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteCond %{REQUEST_URI} !^/(ar|en|fr|login|register|logout)(/|$) [NC]
  RewriteRule ^ - [L]

  # Friendly routes (root)
  RewriteRule ^login/?$ login.php [L,QSA]
  RewriteRule ^register/?$ register.php [L,QSA]
  RewriteRule ^logout/?$ logout.php [L,QSA]

  # =====================================================
  # Language routing (no filesystem dependency)
  # We route /{lang}/... directly to index.php with
  # explicit params consumed by includes/lang_prefix.php
  # =====================================================

  # --- Short category URLs ---
  # /ar/<slug> => __path=/category/<slug>
  # (with reserved path exclusions)
  RewriteCond %{REQUEST_URI} !^/(ar|en|fr)/(search|category|trending|archive|author|tag|news|page|login|register|logout|admin|api|assets)(/|$) [NC]
  RewriteCond %{REQUEST_URI} !^/(robots\.txt|sitemap\.xml|sw\.js|favicon\.ico)$ [NC]
  RewriteRule ^(ar|en|fr)/([^/]+)/?$ index.php?__lang=$1&__path=/category/$2 [L,QSA,NC]

  # Lang home
  RewriteRule ^(ar|en|fr)/?$ index.php?__lang=$1&__path=/ [L,QSA,NC]

  # Any other lang route
  RewriteRule ^(ar|en|fr)/(.*)$ index.php?__lang=$1&__path=/$2 [L,QSA,NC]

  # Everything else -> front controller
  RewriteRule ^.*$ index.php [L,QSA]
</IfModule>

# =========================
# Protect sensitive files
# =========================
<FilesMatch "(\.env|composer\.json|composer\.lock|package\.json|package-lock\.json|yarn\.lock|\.sql|\.bak|\.ini|\.log)$">
  Require all denied
</FilesMatch>
